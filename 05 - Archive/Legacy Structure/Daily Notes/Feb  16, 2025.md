To ensure proper **integration testing** for the **GUI & Processing Controller**, let's define test cases for each category using **Pytest with PySide6 for GUI interaction** and **mocked inputs**.

---

## **Integration Test Plan for GUI & Processing Controller**

These tests will simulate a **real user workflow** from selecting an image to processing completion.

---

### âœ… **1. End-to-End Processing Workflow**

**Check that selecting an image in the GUI correctly processes and saves the outputs.**

#### **Test Case: Full Image Processing Workflow**

```python
import pytest
from PySide6.QtWidgets import QApplication
from pathlib import Path
import os
from src.views.main_window import MainWindow

@pytest.fixture(scope="session")
def qapp():
    """Create a QApplication instance for GUI testing."""
    app = QApplication.instance()
    if app is None:
        app = QApplication([])
    return app

def test_end_to_end_processing(qapp, tmp_path):
    """Test that the full GUI workflow processes and saves images correctly."""
    window = MainWindow()
    
    # Set input image
    test_image_path = "R:/Projects/Python/Mobile_LogoCraft/tests/Logo.png"
    assert os.path.exists(test_image_path), "Test image not found!"
    
    window.handle_image_drop(test_image_path)

    # Set output directory
    output_dir = tmp_path / "processed_images"
    window.path_input.setText(str(output_dir))

    # Simulate clicking process button
    window.process_button.click()

    # Check if all expected outputs exist
    for format_name in window.output_checkboxes.keys():
        output_file = output_dir / f"{format_name}.png"
        assert output_file.exists(), f"Missing output file: {output_file}"

    assert window.status_label.text() == "Processing complete!", "Processing did not complete successfully."
```

---

### âœ… **2. Output Selection Handling**

**Ensure that only selected formats are generated.**

#### **Test Case: Select Only Specific Outputs**

```python
def test_output_selection_handling(qapp, tmp_path):
    """Test that only selected formats are generated."""
    window = MainWindow()
    
    test_image_path = "R:/Projects/Python/Mobile_LogoCraft/tests/Media.jfif"
    assert os.path.exists(test_image_path), "Test image not found!"
    
    window.handle_image_drop(test_image_path)

    # Set output directory
    output_dir = tmp_path / "filtered_outputs"
    window.path_input.setText(str(output_dir))

    # Uncheck all except "APPICON" and "LOGO"
    for format_name, checkbox in window.output_checkboxes.items():
        checkbox.setChecked(format_name in ["APPICON", "LOGO"])

    window.process_button.click()

    # Check if only selected formats exist
    assert (output_dir / "APPICON.png").exists(), "APPICON.png was not created!"
    assert (output_dir / "LOGO.png").exists(), "LOGO.png was not created!"
    
    for format_name in window.output_checkboxes.keys():
        if format_name not in ["APPICON", "LOGO"]:
            assert not (output_dir / f"{format_name}.png").exists(), f"Unexpected output: {format_name}.png"
```

---

### âœ… **3. Progress Updates**

**Validate that the progress bar updates correctly during processing.**

#### **Test Case: Ensure Progress Bar Updates**

```python
def test_progress_updates(qapp, tmp_path):
    """Check that progress updates correctly during processing."""
    window = MainWindow()
    
    test_image_path = "R:/Projects/Python/Mobile_LogoCraft/tests/Logo.png"
    window.handle_image_drop(test_image_path)
    
    output_dir = tmp_path / "progress_test"
    window.path_input.setText(str(output_dir))

    def mock_progress_callback(value, status):
        """Simulate progress callback updates."""
        assert 0.0 <= value <= 1.0, f"Invalid progress value: {value}"
        assert isinstance(status, str), "Progress status should be a string."

    # Replace actual callback with mock
    window.controller.process_image = lambda *_: mock_progress_callback(0.5, "Processing halfway...")

    window.process_button.click()
    assert window.progress_bar.value() > 0, "Progress bar did not update."
```

---

### âœ… **4. Error Handling Integration**

**Ensure that errors (invalid format, low resolution, permission issues) are properly displayed in the UI.**

#### **Test Case: Handle Invalid Image Format**

```python
def test_invalid_format_handling(qapp):
    """Ensure UI properly handles unsupported formats."""
    window = MainWindow()
    
    invalid_file_path = "R:/Projects/Python/Mobile_LogoCraft/tests/invalid.txt"
    window.handle_image_drop(invalid_file_path)

    assert "Unsupported image format" in window.status_label.text(), "Error message missing for invalid file!"
```

#### **Test Case: Handle Low-Resolution Images**

```python
def test_low_resolution_warning(qapp):
    """Ensure UI warns when an image has insufficient resolution."""
    window = MainWindow()
    
    low_res_image_path = "R:/Projects/Python/Mobile_LogoCraft/tests/low_res.png"
    window.handle_image_drop(low_res_image_path)

    assert "Image resolution is below recommended minimum" in window.status_label.text(), "Low-resolution warning not displayed!"
```

#### **Test Case: Handle Output Directory Permission Issues**

```python
import os
import stat

def test_output_directory_permission_issue(qapp, tmp_path):
    """Ensure the application handles read-only output directories."""
    window = MainWindow()
    
    test_image_path = "R:/Projects/Python/Mobile_LogoCraft/tests/Logo.png"
    window.handle_image_drop(test_image_path)

    # Set a read-only directory as output
    readonly_dir = tmp_path / "readonly_output"
    readonly_dir.mkdir()
    os.chmod(readonly_dir, stat.S_IREAD)

    window.path_input.setText(str(readonly_dir))
    window.process_button.click()

    assert "Cannot create output directory" in window.status_label.text(), "Permission error not handled!"
```

---

## **Running the Tests**

To run all integration tests:

```bash
pytest tests/integration_tests.py -v
```

OR, to run just one:

```bash
pytest tests/integration_tests.py::test_end_to_end_processing -v
```

---

### **âœ… Expected Results**

|**Test Case**|**Expected Result**|
|---|---|
|End-to-End Processing Workflow|GUI processes image, all expected outputs are generated.|
|Output Selection Handling|Only checked formats are created, unchecked ones are missing.|
|Progress Updates|Progress bar updates dynamically, values remain valid.|
|Error Handling - Invalid Format|Error message appears for unsupported formats.|
|Error Handling - Low Resolution|Warning appears when image resolution is too low.|
|Error Handling - Output Directory|Error message appears when permissions block file writing.|

---

### **ðŸ”¹ Next Steps**

- Would you like **additional test cases** (e.g., GUI responsiveness, multi-image batch processing)?
- Want to **automate UI clicks** using **Selenium** for PySide6?

Let me know, and Iâ€™ll refine this further! ðŸš€