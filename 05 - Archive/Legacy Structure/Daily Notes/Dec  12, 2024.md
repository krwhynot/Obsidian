![[Documentating Code  Guide]]![[msedge_YlMnTYysT8.png]]


' VBA Script to Analyze Current Workbook and Report Information
Sub AnalyzeWorkbook()
    Dim ws As Worksheet
    Dim nm As Name
    Dim rng As Range
    Dim reportWs As Worksheet
    Dim reportRow As Long
    Dim pt As PivotTable
    Dim chartObj As ChartObject
    Dim vbComp As Object

    On Error Resume Next
    Set reportWs = ThisWorkbook.Sheets("Workbook Analysis Report")
    If reportWs Is Nothing Then
        Set reportWs = ThisWorkbook.Sheets.Add
        Do While WorksheetExists(reportWs.Name)
            reportWs.Name = reportWs.Name & "_1"
        Loop
    End If
    On Error GoTo 0

    reportWs.Cells.Clear
    reportRow = 1

    reportWs.Cells(reportRow, 1).Value = "Workbook Structure: Sheets, Columns, and Protection Status"
    reportRow = reportRow + 1
    For Each ws In ThisWorkbook.Sheets
        reportWs.Cells(reportRow, 1).Value = "Sheet Name: " & ws.Name
        If ws.UsedRange Is Nothing Then
            reportWs.Cells(reportRow, 2).Value = "Columns: 0"
        Else
            reportWs.Cells(reportRow, 2).Value = "Columns: " & ws.UsedRange.Columns.Count
        End If
        reportWs.Cells(reportRow, 3).Value = "Protected: " & ws.ProtectContents
        reportRow = reportRow + 1
    Next ws
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Validation Requirements for Columns"
    reportRow = reportRow + 1
    For Each ws In ThisWorkbook.Sheets
        If Not ws.UsedRange Is Nothing Then
            For Each rng In ws.UsedRange
                If Not rng Is Nothing Then
                    If Not rng.validation Is Nothing Then
                        If rng.validation.Type <> xlNone Then
                            reportWs.Cells(reportRow, 1).Value = "Sheet: " & ws.Name
                            reportWs.Cells(reportRow, 2).Value = "Cell: " & rng.Address
                            reportWs.Cells(reportRow, 3).Value = "Validation Type: " & rng.validation.Type
                            reportRow = reportRow + 1
                        End If
                    End If
                End If
            Next rng
        End If
    Next ws
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Conditional Formatting Rules"
    reportRow = reportRow + 1
    For Each ws In ThisWorkbook.Sheets
        If Not ws.UsedRange Is Nothing Then
            For Each rng In ws.UsedRange
                If Not rng Is Nothing Then
                    If Not rng.FormatConditions Is Nothing Then
                        If rng.FormatConditions.Count > 0 Then
                            reportWs.Cells(reportRow, 1).Value = "Sheet: " & ws.Name
                            reportWs.Cells(reportRow, 2).Value = "Cell: " & rng.Address
                            reportWs.Cells(reportRow, 3).Value = "Conditions: " & rng.FormatConditions.Count
                            reportRow = reportRow + 1
                        End If
                    End If
                End If
            Next rng
        End If
    Next ws
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Name Manager: Defined Ranges and Formulas"
    reportRow = reportRow + 1
    For Each nm In ThisWorkbook.Names
        reportWs.Cells(reportRow, 1).Value = "Name: " & nm.Name
        reportWs.Cells(reportRow, 2).Value = "Refers To: " & nm.RefersTo
        reportRow = reportRow + 1
    Next nm
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Formulas in Workbook"
    reportRow = reportRow + 1
    For Each ws In ThisWorkbook.Sheets
        If Not ws.UsedRange Is Nothing Then
            For Each rng In ws.UsedRange
                If rng.HasFormula Then
                    reportWs.Cells(reportRow, 1).Value = "Sheet: " & ws.Name
                    reportWs.Cells(reportRow, 2).Value = "Cell: " & rng.Address
                    reportWs.Cells(reportRow, 3).Value = "Formula: " & rng.formula
                    reportRow = reportRow + 1
                End If
            Next rng
        End If
    Next ws
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Existing PivotTables and Charts"
    reportRow = reportRow + 1
    For Each ws In ThisWorkbook.Sheets
        For Each pt In ws.PivotTables
            reportWs.Cells(reportRow, 1).Value = "Sheet: " & ws.Name
            reportWs.Cells(reportRow, 2).Value = "PivotTable: " & pt.Name
            reportRow = reportRow + 1
        Next pt
        For Each chartObj In ws.ChartObjects
            reportWs.Cells(reportRow, 1).Value = "Sheet: " & ws.Name
            reportWs.Cells(reportRow, 2).Value = "Chart: " & chartObj.Name
            reportRow = reportRow + 1
        Next chartObj
    Next ws
    reportRow = reportRow + 1

    reportWs.Cells(reportRow, 1).Value = "Existing Macros or VBA Code"
    reportRow = reportRow + 1
    On Error Resume Next
    If Not ThisWorkbook.VBProject Is Nothing Then
        For Each vbComp In ThisWorkbook.VBProject.VBComponents
            reportWs.Cells(reportRow, 1).Value = "Module: " & vbComp.Name
            If vbComp.CodeModule.CountOfLines > 0 Then
                reportWs.Cells(reportRow, 2).Value = "Lines of Code: " & vbComp.CodeModule.CountOfLines
            End If
            reportRow = reportRow + 1
        Next vbComp
    Else
        reportWs.Cells(reportRow, 1).Value = "VBProject not accessible or trusted."
        reportRow = reportRow + 1
    End If
    On Error GoTo 0

    MsgBox "Workbook analysis completed. Report created in 'Workbook Analysis Report'."
End Sub

Function WorksheetExists(sheetName As String) As Boolean
    Dim ws As Worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets(sheetName)
    WorksheetExists = Not ws Is Nothing
    On Error GoTo 0
End Function

